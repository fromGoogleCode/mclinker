# Unit Test #

MCLinker contains a set of unit tests inside the MCLinker repository. MCLinker involves [googletest](http://code.google.com/p/googletest/wiki/V1_6_Primer) as the testing infrastructure. A unit test is a small piece of code to test a specific feature of MCLinker. The code fragment is independent of the main program and can be run and tested by configuration setting. The unit tests are stored in the directory ${MCLINKER\_SRC}/unittests.

Unit tests help to test a specific class and its functions of MCLinker in a simple way. Below we give a short tutorial of how to create and write a unit test.

### Create Unit Tests ###

MCLinker provides its own developing environment. The class template helps developers to generate the basic class header and implementation files. To involve the developing environment, go into project directory and run

```
  source ./scripts/envsetup.sh
```

This setup enables the function _add\_class_, which is a convenient command to generate the class files. To generate a normal class for MCLinker or a testing class, simply type the command _add\_class_ and follow the step by step intructions to finished the process of adding class.

```
  [user@localhost]$ add_class
  Your name? username
  Your email? username@mail.com
```

This command will ask for your name and e-mail address at the first time of execution.Your name and e-mail address will be shown in the header of the generated class file. You can edit the file ${HOME}_/.bold/config_ to modify them.

Next, the two options are shown for you to choose the class type.
For generating a normal class, choose 1.
```
  What kind of class do you want to create?
    1) normal class
    2) test suite
  Your choice? 1
```


Then type in the class name in the following question.
```
  What is the class name? ClassName
```

After the above operations, two class files, ClassName.cpp and ClassName.h, are generated in the directory ${MCLINKER\_SRC}/include and ${MCLINKER\_SRC}/lib.



To generate a unit test, choose 2, and then type in the class name of the testing target class in the following question.
The target class might be one of the existing class in MCLinker.

```
  What is the class you want to test for? Testee
```

Then, _add\_class_ will generate two class files with the name of testing class name plus "Test".
In the above example, two files are generated:
  1. TesteeTest.cpp
  1. TesteeTest.h
These files are loacated in the unit test directory, ${MCLINKER\_SRC}/unittests/

### Write a Unit Test ###

Here we give a quick guide of writing a unit test.
Please refer to [googletest](http://code.google.com/p/googletest/wiki/V1_6_Primer) for detail usage of unit test.

As above example, the test class is generated:
```
#ifndef TESTEE_TEST_H
#define TESTEE_TEST_H

#include <gtest.h>

namespace mcld
{
class Testee;
} // namespace for mcld

namespace mcldTest
{

class TesteeTest : public ::testing::Test
{
public:
        // Constructor can do set-up work for all test here.
        TesteeTest();

        // Destructor can do clean-up work that doesn't throw exceptions here.
        virtual ~TesteeTest();

        // SetUp() will be called immediately before each test.
        virtual void SetUp();

        // TearDown() will be called immediately after each test.
        virtual void TearDown();

private:
        BOLD::Testee* m_pTestee;
};

} // namespace of mcldTest

#endif
```
This program template will be generated by _add\_class_.
All test cases of MCLinker should belong in the namespace, _mcldTest_.

Now we are going to test a member function in Testee, called _int method(int);_, which looks like:
```
namespace mcld
{

class Testee
{
public:
        int method( int a ) {
                return (a+3);
        }
};

} // namespace of mcld
```

Then, in TesteeTest.cpp, a function _TEST\_F_ is added as follow:
```
TEST_F( TesteeTest, method_behavior ) {
      EXPECT_EQ( 4, m_pTestee->method(1) );
}
```
_method\_behavior_ can be any string (without space inside) as a name of this test case.
The method _EXPECT\_EQ_ is a testing function provided by google test.
It verifies if the result of _m\_pTestee->method(1)_ is 4 or not.

More test cases can be added to test Testee by adding more _TEST\_F_ functions.

After the unit test has finished, edit Makefile.am in  ${MCLINKER\_SRC}/debug/ to add the testing files into MCLinker\_SOURCES

```
  15
  16  MCLinker_SOURCES = ${SRCDIR}/main.cpp \
  17                     ${SRCDIR}/Testee.cpp \
  18                     ${UNITTEST}/TesteeTest.h \
  19                     ${UNITTEST}/TesteeTest.cpp
  20
```

Finally, after finishing the above processes, you can rebuild the project and run unit test to check the result.